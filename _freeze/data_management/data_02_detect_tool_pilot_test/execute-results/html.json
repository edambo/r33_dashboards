{
  "hash": "69e3add322203e46a00095f454e60784",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Create variables for visualizing the DETECT tool pilot study data\"\n---\n\n\n# Overview\n\nIn this file, we create some new variables that summarize the completion and missingness counts for various variables in the DETECT tool pilot study data. These new variables will used in creating interactive plots using the plotly package. \n\n\n# Load packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr, warn.conflicts = FALSE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'dplyr' was built under R version 4.3.3\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(readr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'readr' was built under R version 4.3.2\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'here' was built under R version 4.3.3\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(crosstalk)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'crosstalk' was built under R version 4.3.2\n```\n\n\n:::\n:::\n\n\n\n# Load data\n\n\n::: {.cell}\n\n```{.r .cell-code}\npilot_data <- readRDS(here::here(\"data\", \"detect_tool_pilot.RDS\"))\nvar_desc <- readRDS(here::here(\"data\", \n                               \"detect_tool_pilot_variable_descriptions.RDS\"))\n```\n:::\n\n\n\n# Select variables useful for the dashboard\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndash_vars <- c(\"record_id\", \"reporting_instrument_complete\", \"ri_date\", \n               \"ri_patient_mrn\", \"ri_institution_7cat_f\", \"ri_clinician_id\", \n               \"ri_clinician_id_name\", \"ri_necessities_3cat_f\", \n               \"ri_environment_3cat_f\", \"ri_environment_un_reason\", \n               \"ri_caregiver_3cat_f\", \"ri_caregiver_un_reason_2cat_f\", \n               \"ri_caregiver_oth\", \"ri_sedated_3cat_f\", \"ri_isolated_3cat_f\", \n               \"ri_anxious_3cat_f\", \"ri_prohibited_3cat_f\", \n               \"ri_unmet_needs_3cat_f\", \"ri_injuries_3cat_f\", \n               \"ri_patient_assess\", \"suspect_em_2cat_f\", \"ri_em_no_reason\", \n               \"ri_em_reason\", \"ri_em_type_1_2cat_f\", \"ri_em_type_2_2cat_f\", \n               \"ri_em_type_3_2cat_f\", \"ri_em_type_4_2cat_f\", \"ri_em_type_5_2cat_f\", \n               \"ri_em_type_6_2cat_f\", \"ri_em_type_7_2cat_f\", \"ri_em_type_98_2cat_f\", \n               \"ri_em_type_99_2cat_f\", \"ri_em_type_other\", \"ri_report_2cat_f\", \n               \"ri_aps_no_reason\", \"ri_refer_svcs_2cat_f\", \n               \"ri_refer_svcs_specify\", \"ri_reflection_2cat_f\", \n               \"ri_reflection_notes\")\n\ndash_data <- pilot_data %>% select(all_of(dash_vars))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nind_em_vars <- c(\"ri_necessities_3cat_f\", \"ri_environment_3cat_f\", \n                 \"ri_caregiver_3cat_f\", \"ri_sedated_3cat_f\", \n                 \"ri_isolated_3cat_f\", \"ri_anxious_3cat_f\", \n                 \"ri_prohibited_3cat_f\", \"ri_unmet_needs_3cat_f\", \n                 \"ri_injuries_3cat_f\")\n```\n:::\n\n\n# Missingness data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmissing_data <- dash_data\n```\n:::\n\n\n## Create fuction to generate missingness variables\n\nThis function will also take branching/ skip logic into consideration.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npilot_miss <- function(df, var, condition = NULL){\n  if(is.null(condition)){\n    new_df <- df %>% \n      mutate(\n        \"{var}_miss\" := case_when(\n          is.na(.data[[var]]) ~ 1,\n          TRUE ~ 0\n        )\n      )\n  }else if(!is.null(condition)){\n    new_df <- df %>%\n      mutate(\n         \"{var}_miss\" := case_when(\n           eval(parse(text = condition)) & is.na(.data[[var]]) ~ 1,\n           !(eval(parse(text = condition))) & is.na(.data[[var]]) ~ NA,\n           eval(parse(text = condition)) & !is.na(.data[[var]]) ~ 0\n        )       \n      )\n  }\n  \n  new_df %>% relocate(paste0(var, \"_miss\"), .after = var)\n}\n```\n:::\n\n\n## Variables with no conditional arguments/ skip logic\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvars <- c(\"ri_patient_mrn\", \"ri_institution_7cat_f\", \"ri_clinician_id_name\", \n          \"ri_necessities_3cat_f\", \"ri_environment_3cat_f\", \n          \"ri_caregiver_3cat_f\", \"ri_sedated_3cat_f\", \"ri_isolated_3cat_f\", \n          \"ri_anxious_3cat_f\", \"ri_prohibited_3cat_f\", \"ri_unmet_needs_3cat_f\", \n          \"ri_injuries_3cat_f\", \"suspect_em_2cat_f\", \"ri_reflection_2cat_f\"\n          )\ncondition <- NULL\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfor(var in vars){\n  missing_data <- pilot_miss(df = missing_data, var = var, \n                     condition = condition)  \n}\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Using an external vector in selections was deprecated in tidyselect 1.1.0.\nℹ Please use `all_of()` or `any_of()` instead.\n  # Was:\n  data %>% select(var)\n\n  # Now:\n  data %>% select(all_of(var))\n\nSee <https://tidyselect.r-lib.org/reference/faq-external-vector.html>.\n```\n\n\n:::\n:::\n\n\n## Variables with conditional arguments/ skip logic\n\n### ri_environment_un_reason\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvar <- \"ri_environment_un_reason\"\n\ncondition_vars <- c(\"ri_necessities_3cat_f\", \"ri_environment_3cat_f\")\n\ncondition <- \"if_any(.cols = all_of(condition_vars), .fns = ~.x == 'Unable to assess')\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmissing_data <- pilot_miss(df = missing_data, var = var, \n                   condition = condition)\n```\n:::\n\n\n### ri_caregiver_un_reason\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvar <- \"ri_caregiver_un_reason_2cat_f\"\ncondition <- \"ri_caregiver_3cat_f == 'Unable to assess'\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmissing_data <- pilot_miss(df = missing_data, var = var, \n                   condition = condition) \n```\n:::\n\n\n### ri_caregiver_oth\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvar <- \"ri_caregiver_oth\"\ncondition <- \"ri_caregiver_un_reason_2cat_f == 'Other reason'\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmissing_data <- pilot_miss(df = missing_data, var = var, \n                   condition = condition)\n```\n:::\n\n\n### ri_patient_assess\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvar <- \"ri_patient_assess\"\n\ncondition_vars <- c(\"ri_sedated_3cat_f\", \"ri_isolated_3cat_f\",\n                    \"ri_anxious_3cat_f\", \"ri_prohibited_3cat_f\", \n                    \"ri_unmet_needs_3cat_f\", \"ri_injuries_3cat_f\")\n\ncondition <- \"if_any(.cols = all_of(condition_vars), .fns = ~.x == 'Unable to assess')\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmissing_data <- pilot_miss(df = missing_data, var = var, \n                   condition = condition)\n```\n:::\n\n\n### ri_em_no_reason\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvar <- \"ri_em_no_reason\"\n\ncondition_vars <- c(\"ri_necessities_3cat_f\", \"ri_environment_3cat_f\",\n                    \"ri_caregiver_3cat_f\", \"ri_sedated_3cat_f\", \n                    \"ri_isolated_3cat_f\", \"ri_anxious_3cat_f\", \n                    \"ri_prohibited_3cat_f\", \"ri_unmet_needs_3cat_f\", \n                    \"ri_injuries_3cat_f\")\n\ncondition <- \"suspect_em_2cat_f == 'No' & if_any(.cols = all_of(condition_vars), \n.fns = ~.x == 'Yes')\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmissing_data <- pilot_miss(df = missing_data, var = var, \n                   condition = condition)\n```\n:::\n\n\n### ri_em_reason\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvar <- \"ri_em_reason\"\n\ncondition_vars <- c(\"ri_necessities_3cat_f\", \"ri_environment_3cat_f\",\n                    \"ri_caregiver_3cat_f\", \"ri_sedated_3cat_f\", \n                    \"ri_isolated_3cat_f\", \"ri_anxious_3cat_f\", \n                    \"ri_prohibited_3cat_f\", \"ri_unmet_needs_3cat_f\", \n                    \"ri_injuries_3cat_f\")\n\ncondition <- \"suspect_em_2cat_f == 'Yes' & if_all(.cols = all_of(condition_vars), \n.fns = ~.x != 'Yes')\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmissing_data <- pilot_miss(df = missing_data, var = var, \n                   condition = condition)\n```\n:::\n\n\n### EM Type vars\n\n\n::: {.cell}\n\n```{.r .cell-code}\nem_type_vars <- c(\"ri_em_type_1_2cat_f\", \"ri_em_type_2_2cat_f\", \"ri_em_type_3_2cat_f\", \n          \"ri_em_type_4_2cat_f\", \"ri_em_type_5_2cat_f\", \"ri_em_type_6_2cat_f\", \n          \"ri_em_type_7_2cat_f\", \"ri_em_type_98_2cat_f\", \"ri_em_type_99_2cat_f\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmissing_data <- missing_data %>%\n  mutate(\n    ri_em_type_miss = case_when(\n      suspect_em_2cat_f == 'Yes' & \n        if_all(.cols = all_of(em_type_vars), \n               .fns = ~.x == \"No\") ~ 1,\n      suspect_em_2cat_f != 'Yes' & \n        if_all(.cols = all_of(em_type_vars), \n               .fns = ~.x == \"No\") ~ NA,\n      suspect_em_2cat_f == 'Yes' & \n        if_any(.cols = all_of(em_type_vars), \n               .fns = ~.x == \"Yes\") ~ 0      \n      )\n  )\n```\n:::\n\n\n### ri_em_type_other\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvar <- \"ri_em_type_other\"\ncondition <- \"ri_em_type_98_2cat_f == 'Checked'\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmissing_data <- pilot_miss(df = missing_data, var = var, \n                   condition = condition)\n```\n:::\n\n\n### ri_report_2cat_f\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvar <- \"ri_report_2cat_f\"\ncondition <- \"suspect_em_2cat_f == 'Yes'\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmissing_data <- pilot_miss(df = missing_data, var = var, \n                   condition = condition)\n```\n:::\n\n\n### ri_aps_no_reason\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvar <- \"ri_aps_no_reason\"\ncondition <- \"ri_report_2cat_f == 'No'\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmissing_data <- pilot_miss(df = missing_data, var = var, \n                   condition = condition)\n```\n:::\n\n\n### ri_refer_svcs_2cat_f\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvar <- \"ri_refer_svcs_2cat_f\"\ncondition <- \"suspect_em_2cat_f == 'Yes'\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmissing_data <- pilot_miss(df = missing_data, var = var, \n                   condition = condition)\n```\n:::\n\n\n### ri_refer_svcs_specify\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvar <- \"ri_refer_svcs_specify\"\ncondition <- \"ri_refer_svcs_2cat_f == 'Yes'\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmissing_data <- pilot_miss(df = missing_data, var = var, \n                   condition = condition) \n```\n:::\n\n\n### ri_reflection_notes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvar <- \"ri_reflection_notes\"\ncondition <- \"ri_reflection_2cat_f == 'Yes'\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmissing_data <- pilot_miss(df = missing_data, var = var, \n                   condition = condition)\n```\n:::\n\n\n\n# Prepare Missingness data for visualization\n\n## All data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlabel_order <- c(\n  \"Brief note\", \"Have helpful details\", \"Specify other service\", \n  \"Other service referral\", \"No intention to report to APS reason\", \n  \"Intend to report to APS\", \"Specific other mistreatment type suspected\", \n  \"EM type\", \"Suspect EM reason\", \n  \"Indicators observed but EM not suspected reason\", \n  \"Suspect EM\", \"Patient not assessed reason\", \n  \"Unexplained injuries\", \"Unmet needs\", \"Prohibited\", \"Anxious\", \"Isolated\", \n  \"Chemically sedated\", \"Other reason caregiver not assessed\", \n  \"Caregiver not assessed reason\", \"Defensive\", \n  \"Environment not assessed reason\", \"Environment health or safety concern\", \n  \"Absence of necessities \", \"Clinician name\", \"Institution\", \"Patient MRN\"\n)\n\nmissing_plot_data <- missing_data %>% \n  # Select only the record id and the missng data variables\n  select(record_id, ends_with(\"_miss\")) %>%\n  # Remove \"_miss\" suffix\n  rename_with(~gsub(\"_miss\", \"\", .x)) %>%\n  tidyr::pivot_longer(!record_id, names_to = \"var\", values_to = \"missingness\") %>%\n  # Recode missingness\n  mutate(\n    missingness_3cat_f = case_when(\n      missingness == 1 ~ \"Missing\",\n      missingness == 0 ~ \"Not missing\",\n      is.na(missingness) ~ \"Not applicable\"\n    ),\n    missingness_3cat_f = factor(missingness_3cat_f, \n                     levels = c(\"Missing\", \"Not missing\", \"Not applicable\")\n                     )\n  ) %>%\n  # Create count column\n  group_by(var, missingness_3cat_f) %>%\n  mutate(\n    count = n()\n  ) %>% ungroup() %>% \n  select(-c(record_id)) %>%\n  distinct() %>% \n  # Add labels\n  left_join(var_desc, by = c(\"var\" = \"variable\")) %>%\n  # Create label for aggregate variable \"ri_em_type\"\n  mutate(\n    label = case_when(\n      var == \"ri_em_type\" ~ \"EM type\",\n      TRUE ~ label\n    )\n  ) %>% \n  mutate(\n    # Ensure the correct order of labels is maintained in the plot\n    label = factor(label, levels = label_order)\n    \n  )\n```\n:::\n\n\n## Text box data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntext_box_items <- c(\"ri_environment_un_reason\", \"ri_caregiver_oth\",\n                    \"ri_patient_assess\", \"ri_em_no_reason\", \"ri_em_reason\", \n                    \"ri_em_type_other\", \"ri_aps_no_reason\", \n                    \"ri_refer_svcs_specify\", \"ri_reflection_notes\")\n\ntext_box_miss <- sort(c(text_box_items, paste0(text_box_items, \"_miss\")))\n\ntext_box_data <- missing_data %>% select(record_id, all_of(text_box_miss))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# For each text box variable, create a variable that shows whether or not there is a value\nfor(i in text_box_items){\n  text_box_data <- text_box_data %>%\n    mutate(\n      \"{i}_filled_3cat_f\" := case_when(\n        .data[[paste0(i, \"_miss\")]] == 0 ~ \"Filled\",\n        .data[[paste0(i, \"_miss\")]] == 1 ~ \"Not filled\",\n        is.na(.data[[paste0(i, \"_miss\")]]) ~ \"Not applicable\"\n      )\n    ) %>% relocate(paste0(i, \"_filled_3cat_f\"), .after = i)\n}\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Using an external vector in selections was deprecated in tidyselect 1.1.0.\nℹ Please use `all_of()` or `any_of()` instead.\n  # Was:\n  data %>% select(i)\n\n  # Now:\n  data %>% select(all_of(i))\n\nSee <https://tidyselect.r-lib.org/reference/faq-external-vector.html>.\n```\n\n\n:::\n:::\n\n\n### Plot data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntext_box_plot_data <- text_box_data %>% \n  select(record_id, ends_with(\"filled_3cat_f\")) %>%\n  mutate(\n    across(\n      .cols = !record_id,\n      .fns = ~ factor(.x,\n                      levels = c(\"Filled\", \"Not filled\", \"Not applicable\")\n                      )\n    )\n  ) %>%\n  tidyr::pivot_longer(!record_id, names_to = \"var\", values_to = \"filled\") %>%\n  # Create count column\n  group_by(var, filled) %>%\n  mutate(\n    count = n()\n  ) %>% ungroup() %>% \n  select(-c(record_id)) %>%\n  distinct() %>%\n  # Remove \"filled_3cat_f\" suffix to allow labels to match\n  mutate(\n    var = gsub(\"_filled_3cat_f\", \"\", var)\n  )%>%\n  # Add labels\n  left_join(var_desc, by = c(\"var\" = \"variable\")) %>%\n  # Ensure the order of labels in dataframe is maintained in the plot\n  mutate(\n    label = factor(label, levels = rev(unique(label)))\n  )\n\n# Ensure that unused categories still show up in plot\ntext_box_plot_data <- bind_rows(text_box_plot_data, \n                  data.frame(filled = setdiff(levels(text_box_plot_data$filled), \n                                              unique(text_box_plot_data$filled)\n                                              )\n                             )\n                  )\n```\n:::\n\n\n\n## Table data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntext_box_table_data <- text_box_data %>% \n  # select(record_id, ends_with(\"filled_3cat_f\")) %>%\n  select(-c(ends_with(\"_miss\"))) %>%\n  mutate(\n    across(\n      .cols = ends_with(\"filled_3cat_f\"),\n      .fns = ~ factor(.x,\n                      levels = c(\"Filled\", \"Not filled\", \"Not applicable\")\n                      )\n    )\n  ) %>%\n  tidyr::pivot_longer(cols = ends_with(\"filled_3cat_f\"), \n                      names_to = \"var\", values_to = \"filled\") %>%\n  filter(filled == \"Filled\") %>% select(-c(filled, var)) %>%\n  tidyr::pivot_longer(cols = !record_id, \n                      names_to = \"var\", values_to = \"content\") %>%\n  filter(!is.na(content)) %>% \n  # Add labels\n  left_join(var_desc, by = c(\"var\" = \"variable\")) %>% select(-c(description)) %>%\n  relocate(label, .after = var) %>% distinct() %>%\n  # Make record_id a factor variable to prevent slider column filter\n  mutate(\n    record_id = factor(record_id)\n  )\n```\n:::\n\n\n# Other plots\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshared_plot_data <- dash_data %>% \n  select(-c(reporting_instrument_complete, ri_date, ri_patient_mrn)) %>%\n  tidyr::pivot_longer(-c(record_id, ri_institution_7cat_f, ri_clinician_id), \n                      names_to = \"var\", values_to = \"value\") %>%\n  # Add labels\n  left_join(var_desc, by = c(\"var\" = \"variable\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Function for creating data subsets\ndata_subset <- function(vars, level_list){\n  df <- shared_plot_data %>% filter(var %in% vars) %>%\n    mutate(\n      # Convert NA into a character value\n      value = case_when(is.na(value) ~ \"NA\",\n                        TRUE ~ value),\n      value = factor(value, \n                     levels = c(level_list, \"NA\"),\n                     exclude = NULL\n                     ),\n      # Ensure the order of labels in dataframe is maintained in the plot\n      label = factor(label, levels = rev(unique(label)))\n    )\n}\n```\n:::\n\n\n## Indicators of abuse\n\n\n::: {.cell}\n\n```{.r .cell-code}\nind_em_plot_data <- data_subset(ind_em_vars, \n                                        level_list = c(\"Yes\", \"No\", \"Unable to assess\"))\n```\n:::\n\n\n## Suspect EM\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsuspect_em_plot_data <- data_subset(\"suspect_em_2cat_f\", \n                                        level_list = c(\"Yes\", \"No\"))\n```\n:::\n\n\n## EM Type\n\n\n::: {.cell}\n\n```{.r .cell-code}\nem_type_plot_data <- data_subset(em_type_vars, \n                                        level_list = c(\"Yes\", \"No\"))\n```\n:::\n\n\n## Intent to Report to APS\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreport_plot_data <- data_subset(\"ri_report_2cat_f\", \n                                        level_list = c(\"Yes\", \"No\"))\n```\n:::\n\n\n# Interactivity\nCreate individual shared data for each topic\n\n## Indicators of EM Module\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Character vector of filters\nfilters <- c(\n \"Suspect EM\", \"Self-neglect suspected\", \"Financial exploitation suspected\", \n \"Emotional or psychological abuse suspected\", \"Physical abuse suspected\", \n \"Sexual abuse suspected\", \"Caregiver neglect suspected\", \n \"Abandonment suspected\", \"Other mistreatment type suspected\", \n \"Dont know/ Not sure of mistreatment type\", \"Intend to report to APS\",\n \"Other service referral\", \"Have helpful details\"\n)\n\nfilters <- stringr::str_wrap(filters, width = 30)\n\nind_em_shared_data <- dash_data %>% \n  select(-c(reporting_instrument_complete, ri_date, ri_patient_mrn, \n            ri_reflection_2cat_f)) %>%\n  tidyr::pivot_longer(all_of(ind_em_vars), \n                      names_to = \"em_ind_var\", values_to = \"em_ind_value\") %>%\n  # Add labels\n  left_join(var_desc, by = c(\"em_ind_var\" = \"variable\")) %>%\n  # Make `label` a factor variable\n  rename(\n    \"ind_em_label\" = \"label\"\n  ) %>%\n  mutate(\n    # Include line breaks in labels\n    ind_em_label = stringr::str_wrap(ind_em_label, width = 30),\n    ind_em_label = factor(ind_em_label)\n  ) %>%\n  # Filter where indicators of abuse have values of Yes\n  filter(em_ind_value == \"Yes\") %>%\n  tidyr::pivot_longer(c(\"suspect_em_2cat_f\", all_of(em_type_vars),\n                        \"ri_report_2cat_f\", \"ri_refer_svcs_2cat_f\"), \n                      names_to = \"filter_var\", values_to = \"filter_value\") %>%\n  # Make the value variable a factor\n  mutate(\n    filter_value = factor(filter_value, levels = c(\"No\", \"Yes\"))\n  ) %>%\n  # Add filter labels\n  left_join(var_desc, by = c(\"filter_var\" = \"variable\")) %>%\n  # Make `label` a factor variable\n  mutate(\n    # Include line breaks in labels\n    label = stringr::str_wrap(label, width = 30),\n    label = factor(label, levels = filters) \n    )%>%\n  # Create crosstalk shared data object\n  crosstalk::SharedData$new(.)\n```\n:::\n\n\n# Save data\n\n\n::: {.cell}\n\n```{.r .cell-code}\npath <- here::here(\"data\", \"dashboard_prepped_data.RData\")\nsave(missing_plot_data, text_box_table_data, \n     ind_em_plot_data, suspect_em_plot_data, em_type_plot_data, \n     report_plot_data, ind_em_shared_data, file = path)\n```\n:::\n",
    "supporting": [
      "data_02_detect_tool_pilot_test_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}